#!/bin/bash

source imosh || exit 1
eval "${IMOSH_INIT}"

if [ "$#" -ne 1 ]; then
  LOG FATAL 'Exactly one argument is required.'
fi

cd
USER="${1}"
case "${USER}" in
  chokudai|imos|iwiwi|sulume|tos|wata)
    if mount | grep "on /home/ninelet/${USER} type overlayfs" >/dev/null; then
      sudo fuser --kill "/home/ninelet/${USER}" || true
      sudo umount -f "/home/ninelet/${USER}"
    else
      LOG ERROR "/home/ninelet/${USER} is not mounted."
    fi
    sudo mount -t overlayfs \
        -o "lowerdir=/mirror/github,upperdir=/alloc/dropbox/${USER}" \
        overlayfs "/home/ninelet/${USER}"
    ;;
  *)
    LOG FATAL "Unknown user: ${USER}"
    ;;
esac
